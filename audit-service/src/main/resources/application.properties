# ===================================================================
# Audit Service Configuration
# ===================================================================

# Application
quarkus.application.name=audit-service
quarkus.http.port=8088
quarkus.http.host=0.0.0.0

# ===================================================================
# Database Configuration (PostgreSQL Reactive)
# ===================================================================

quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=postgres
quarkus.datasource.password=postgres

# Reactive PostgreSQL
quarkus.datasource.reactive.url=postgresql://localhost:5432/hospital_db
quarkus.datasource.reactive.max-size=20

# Hibernate ORM
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=true
quarkus.hibernate-orm.log.bind-parameters=true
quarkus.hibernate-orm.statistics=true
quarkus.hibernate-orm.sql-load-script=no-file

# Flyway (disabled in services - run migrations centrally)
quarkus.flyway.migrate-at-start=false

# ===================================================================
# Consul Service Discovery
# ===================================================================

# Consul Agent
quarkus.consul-config.enabled=true
quarkus.consul-config.agent.host-port=localhost:8500

# Service Registration
quarkus.consul-config.agent.discovery-enabled=true
quarkus.consul-config.agent.service-name=${quarkus.application.name}
quarkus.consul-config.agent.service-host=localhost
quarkus.consul-config.agent.service-port=${quarkus.http.port}

# Health Check
quarkus.consul-config.agent.health-check-interval=10s
quarkus.consul-config.agent.health-check-timeout=5s
quarkus.consul-config.agent.health-check-path=/q/health

# ===================================================================
# JWT Configuration
# ===================================================================

jwt.issuer=hospital-system

# SmallRye JWT
mp.jwt.verify.publickey.location=publicKey.pem
mp.jwt.verify.issuer=${jwt.issuer}

# ===================================================================
# Multi-Tenancy Configuration
# ===================================================================

tenant.default-tenant-id=default-tenant

# ===================================================================
# Redis Configuration (Caching)
# ===================================================================

quarkus.redis.hosts=redis://localhost:6379
quarkus.redis.timeout=10s

# Cache Configuration
quarkus.cache.caffeine.audit-logs.expire-after-write=5M
quarkus.cache.caffeine.audit-logs.maximum-size=500

# ===================================================================
# RabbitMQ Configuration (Event Consumers)
# ===================================================================

# Global RabbitMQ Connection
rabbitmq-host=localhost
rabbitmq-port=5672
rabbitmq-username=admin
rabbitmq-password=admin123
rabbitmq-virtual-host=hospital

# Incoming Events - User Registered
mp.messaging.incoming.user-registered-events.connector=smallrye-rabbitmq
mp.messaging.incoming.user-registered-events.queue.name=audit.user.registered
mp.messaging.incoming.user-registered-events.exchange.name=hospital.events.direct
mp.messaging.incoming.user-registered-events.routing-keys=user.registered
mp.messaging.incoming.user-registered-events.exchange.type=direct
mp.messaging.incoming.user-registered-events.exchange.durable=true
mp.messaging.incoming.user-registered-events.queue.durable=true

# Incoming Events - User Updated
mp.messaging.incoming.user-updated-events.connector=smallrye-rabbitmq
mp.messaging.incoming.user-updated-events.queue.name=audit.user.updated
mp.messaging.incoming.user-updated-events.exchange.name=hospital.events.direct
mp.messaging.incoming.user-updated-events.routing-keys=user.updated
mp.messaging.incoming.user-updated-events.exchange.type=direct
mp.messaging.incoming.user-updated-events.exchange.durable=true
mp.messaging.incoming.user-updated-events.queue.durable=true

# ===================================================================
# Health and Metrics
# ===================================================================

# Health Checks
quarkus.smallrye-health.root-path=/q/health

# Prometheus Metrics
quarkus.micrometer.enabled=true
quarkus.micrometer.registry-enabled-default=true
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder.jvm.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics

# ===================================================================
# Logging
# ===================================================================

quarkus.log.level=INFO
quarkus.log.category."com.hospital".level=DEBUG
quarkus.log.category."io.smallrye.reactive.messaging".level=INFO
quarkus.log.console.enable=true
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n

# ===================================================================
# Development Mode
# ===================================================================

%dev.quarkus.log.console.color=true
%dev.quarkus.hibernate-orm.log.sql=true
%dev.quarkus.hibernate-orm.log.bind-parameters=true

# ===================================================================
# Native Build Configuration
# ===================================================================

# Additional build arguments for GraalVM
quarkus.native.additional-build-args=--initialize-at-run-time=org.postgresql.Driver

# Enable all security services for JWT
quarkus.native.enable-all-security-services=true

# ===================================================================
# CORS Configuration (if accessed directly, not via gateway)
# ===================================================================

quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:3000,http://localhost:8080
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with,x-tenant-id
quarkus.http.cors.exposed-headers=x-request-id
